/*
 * ESP8266_H_.c
 *
 *  Created on: 28 sie 2015
 *      Author: Bartek
 */

#include <avr/io.h>
#include <util/delay.h>
#include <string.h>
#include "USART.h"
#include "ESP8266.h"

#define MYUBRR FOSC/16/BAUD-1

void ESP_Init(ESP_InitTypeDef* esp8266_InitStruct)
{
  //Send
	USART_Init(MYUBRR);
}


/**
  * @brief  Connects module with existing network.
  * @brief  Enables or disables the specified USART peripheral.
  * @param  ssid: Pointer to array which contains network identifier.
  * @param  password: Pointer to array which contains network password.
  * @retval None
  */
void ESP_Connect(char* ssid, char* password)
{
//Send USART AT+ CWJAP =<ssid>,<pwd>
	char command[10]={'A','T','+','C','W','J','A','P','=',','};				// Command: AT+CWJAP=<ssid>,<password>
	char comma[1] = {','};
	USART_Send_String(command,9);
	USART_Send_String(ssid, strlen(ssid));
	USART_Send_String(comma,1);
	USART_Send_String(password, strlen(password));

}

void ESP_DeInit()
{
//Send USART AT+RST
	char command[6] = {'A','T','+','R','S','T'};
	USART_Send_String(command, 6);
}


void ESP_PowerOn()
{
	ESP_CHIP_PORT |= (1<<ESP_CHIP_PIN);
}

void ESP_PowerOff()
{
	ESP_CHIP_PORT &= ~(1<<ESP_CHIP_PIN);
}


