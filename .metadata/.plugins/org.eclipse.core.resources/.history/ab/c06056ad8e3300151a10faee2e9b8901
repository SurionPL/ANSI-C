/*
 * TWI.c
 *
 *  Created on: 24 lip 2015
 *      Author: Bartek
 */

#include <avr/io.h>
#include <util/delay.h>
#include <util/twi.h>
uint8_t error;


uint8_t buffer[16];


void ERROR(void) {
    //error = TWSR & 0xF8;   //Zerowanie 3 najmlodszych bitow rejestru statusowego TWSR (Two Wire Stat. Reg.)
    //sprintf(buffer,"E_%02x ", error);
    //sprintf(buffer,"Err_%x ", error);
    //LCD_WriteText(buffer);

}

void TWI_Start()
{
	TWCR = (1<<TWINT) | (1<<TWSTA)| (1<<TWEN);
	while (!(TWCR & (1<<TWINT)));
}
void TWI_Stop()
{
	TWCR = (1<<TWINT) | (1<<TWEN) | (1<<TWSTO);
	while ((TWCR & (1<<TWSTO)));
}

void 	TWI_Write(uint8_t data)
{
	TWDR = data;
	TWCR = (1<<TWINT) | (1<<TWEN);
	while (!(TWCR & (1<<TWINT)));
}

uint8_t TWI_Read(uint8_t ack)
{
	TWCR = ack
	? ((1 << TWINT) | (1 << TWEN) | (1 << TWEA))
	: ((1 << TWINT) | (1 << TWEN)) ;
	while (!(TWCR & (1<<TWINT)));
	return TWDR;
}
